<!DOCTYPE html>
<html lang="en">
<head>
    <title>Forgot Password</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h2>Forgot Password</h2>
        <form id="forgotPasswordForm">
            <input type="text" id="identifier" placeholder="Email / Phone Number" required>
            <button type="submit" id="send-code-btn">Send OTP</button>
        </form>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("send-code-btn").addEventListener("click", function (e) {
        e.preventDefault();

        let emailOrPhone = document.getElementById("identifier").value.trim();
        if (!emailOrPhone) {
            alert("Please enter your email or phone number.");
            return;
        }

        console.log("üì° Sending request to /forgot-password...");

        fetch("/forgot-password", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ identifier: emailOrPhone }),
        })
        .then(response => response.json())
        .then(data => {
            console.log("üîÑ Server Response:", data);
            if (data.message) {
                alert("‚úÖ OTP Sent Successfully!");

                // Store identifier in localStorage
                localStorage.setItem("identifier", emailOrPhone);
                console.log("üìå Stored Identifier:", emailOrPhone); // Debugging

                // Double check if it's stored
                console.log("üõ†Ô∏è Checking stored identifier:", localStorage.getItem("identifier"));

                // Redirect to validate OTP page
                window.location.href = "/templates/validate-otp.html";
            } else {
                alert("‚ùå Error: " + data.error);
            }
        })
        .catch(error => console.error("‚ùå Fetch Error:", error));
    });
});

    </script>
</body>
</html>
